%script{:type => "text/javascript", :src => "http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"}
= session.inspect
%form{ :action => ""}
  .row-fluid
    .span4
      %h4
        #stats.ct
          #max_price_label
            max price
            %label{:id => "money_max_price"}
              = session[:max_price] if session[:max_price]
          #money_left_label
            money left
            %label{:id => "money_left"}
  .row-fluid
    .span4#search_box
      %input{:type => "text", :id => "max_price",  :name => "max_price", :class => "text", :disabled => @selected_items == nil ? nil : "disabled", :placeholder => "Max Price"}
      %input{:type => "text", :id => "menu_item", :name => "menu_item", :class => "text", :placeholder => "Menu Item" }
      %input{:type => "button", :value => "Find", :class => "btn btn-large btn-block", :id => "submit_btn", :onclick => "populate()"}
      %input{:type => "button", :value => "Restart", :class => "btn btn-block", :id => "submit_btn", :onclick => "restart()"}
  .row-fluid
    .span12
      #results
%script{:type => "text/javascript"}
  :plain
    $(document).ready(function(){
      $("#max_price").keyup(function() {
        $("#money_left").text($("#max_price").val());
        $("#money_max_price").text($("#max_price").val());
      });
      
      
    });
    
   

    function populate(){
      //alert("yeay");
      $('#results').load("pages/search/?menu_item=" + $('#menu_item').val() + "&money_left=" + $('#money_left').text());
      
      $(".result_checkboxes").on({
    	click: function(){
      		alert("first");
      		calculateResultCartTotal();
      	}
      });
      
    }

    function restart(){
      //alert("yeay");
    	window.location.replace("http://localhost:3000/pages/restart");
    }
    
    function postToSelf(){
      checked_id = null
      checked_name = null
      checked_price = null
      var allVals = [];
        $('input:checked').each(function() {
          checked_id = $(this).val();
          checked_name = $(this).attr("item_name");
          checked_price = $(this).attr("price");
        });
    	window.location.replace("http://localhost:3000/pages/add_to_cart?max_price=" + $('#max_price').val() + "&money_left="+$('#money_left').text()+"&id="+checked_id+"&name="+checked_name+"&price="+checked_price);
    }
    
    function calculateResultCartTotal(){
    	$('.result_checkboxes').each(function() {
          if ($(this).is(':checked')) {
            $("#money_left").text(parseInt($("#money_left").text()) + parseInt($(this).val()));
          }
        });
    }

    
    
